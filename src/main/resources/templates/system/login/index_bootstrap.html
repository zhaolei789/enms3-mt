<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <!-- 避免IE使用兼容模式 -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
    <meta name="renderer" content="webkit">
    <meta name="keywords" content='easyui,jui,jquery easyui,easyui demo,easyui中文'/>
    <meta name="description" content='KRMIS'/>
    <!-- 浏览器标签图片 -->
    <!--href="/topjui/images/favicon.ico"-->
    <link rel="shortcut icon" th:href="${sysConfig.companyBrowserIcon}"/>
    <link rel="stylesheet" href="/plugins/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="/plugins/font-awesome/css/font-awesome.min.css">
    <style type="text/css">
        html, body {
            height: 100%;
        }

        @keyframes rotate {
            from {
                transform: rotatez(0deg);
            }

            to {
                transform: rotatez(360deg);
            }
        }
        .box {
            background: #f8f8f8 url("/public/images/bg.jpg");
            background-size: 100% 100%;
            margin: 0 auto;
            position: relative;
            width: 100%;
            height: 100%;
        }

        .login-box {
            width: 100%;
            max-width: 450px;
            height: 530px;
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            margin-top: -200px;
            z-index: 999;
            box-shadow: rgba(150,150,150,0.1) 0px 0px 20px 0px;
            /*设置负值，为要定位子盒子的一半高度*/
        }

        .login-box .input-group{
            border-radius: 7px !important;
            background: rgba(58, 170, 254, 0.1);
        }
        .login-box input{
            background: none !important;
            border: none !important;
        }
        @media screen and (min-width: 500px) {
            .login-box{
                left: 35%;
                right: 35%;
                margin: 0;
                top: 50%;
                background: #fff;
                padding: 30px 30px 10px;
                min-height: 530px;
                border-radius: 5px;
                transform: translateY(-50%);
            }
        }

        .form {
            width: 100%;
            max-width: 500px;
            height: 275px;
            margin: 2px auto 0px auto;
        }

        .login-content {
            border-bottom-left-radius: 8px;
            border-bottom-right-radius: 8px;
            height: 310px;
            width: 100%;
            max-width: 450px;
            /*background-color: rgba(255, 250, 2550, .6);*/
            float: left;
        }

        .input-group {
            margin: 15px 0px 0px 0px !important;
        }
        .input-group input{
            width: 100% !important;
            border: none;
            border-bottom: 1px solid #e2e2e2;
            outline: none !important;
            box-shadow: none;
        }
        .input-group-addon{
            border: none;
            background: transparent;
            color: #999;
        }
        .form-control,
        .input-group {
            height: 40px;
        }

        .form-actions {
            margin-top: 20px;
        }

        .form-group {
            margin-bottom: 0px !important;
        }

        .login-title h1 {
            /*margin-top: 10px !important;*/
        }

        .login-title small {
            color: #333;
            /*margin-left: -50px;*/
        }

        .link p {
            line-height: 20px;
            margin-top: 30px;
        }

        .btn-sm {
            padding: 8px 24px !important;
            font-size: 16px !important;
        }

        .tab {
            display: flex;
            margin: 0 auto;
            justify-content: space-around;
            align-items: center;
        }

        .tab-item {
            width: 33.333%;
            height: 50px;
            line-height: 50px;
            text-align: center;
            cursor: pointer;
        }

        .on {
            color: #1E9FFF;
            border-bottom: 2px solid #1E9FFF;
        }

        .form {
            display: none;
        }
        .btn-blue{
            background: #1E9FFF;
            color: #fff;
        }
        .btn-blue:hover,.btn-blue:active,.btn-blue:focus{
            background: #1E9FFF;
            color: #fff;
        }
        .btn:hover{
            opacity: 0.8;
        }
        input:focus,.form-control:focus{
            outline: none !important;
            box-shadow: none;
        }
        button{outline:none !important;}
        @media screen and (max-width: 900px) {
            .login-box{
                left: 20%;
                margin: 0;
                top: 50%;
                background: #fff;
                padding: 10px 20px;
                min-height: 530px;
                border-radius: 5px;
                transform: translateY(-50%);
            }
        }
        .login-bg {
            display: none;
        }
        @media screen and (max-width: 750px) {
            .login-box{
                left: 0;
                margin: 0;
                top: 0;
                background: #fff;
                padding: 0;
                min-height: 100%;
                border-radius: 0;
                width: 100%;
                transform: translateY(0);
            }
            .login-content{
                width: 100%;
            }
            .login-bg {
                display: block;
            }
            .login-bg{
                display: inline-block;
                width: 100%;
                padding-top: 48px;
                padding-bottom: 48px;
                margin-bottom: 10px;
                background-image: url("/public/images/login-bg-mobile.png") !important;
                background-repeat: no-repeat;
                background-size: 100% 100%;
                text-align: center;

            }
            .login-bg .img{
                width:25%;
                margin: 0 auto;
            }
            .login-bg .title{
                padding-top: 19px;
                text-align: center;
                color: #fff;
                font-weight: bold;
                font-size: 19px;
            }
            .content-box .form {
                padding: 0 30px;
            }
        }
        .login-other a{
            text-decoration: none;
        }
        .login-other .fa{
            font-size: 20px;
            color: rgba(0, 0, 0, 0.2);
        }
    </style>
    <title th:text="${sysConfig.systemName}"></title>
</head>
<body>
<div class="box">
    <div class="login-box">
        <div class="login-content" id="myDiv">
            <div class="login-bg">
                <img class="img" th:src="${sysConfig.companyLoginIcon}" alt="">
                <p class="title">精益管控系统</p>
            </div>
            <div>
                <center>
                    <p><h4><b>物资精益管控系统</b></h4></p>
                </center>
            </div>
            <div class="tab" id="tab">
                <div class="tab-item on" id="tab1" th:text="#{user.login.useAccount}">账号密码登录</div>
                <div class="tab-item forget" id="tab2" th:text="#{user.login.other}">更多(敬请期待)</div>
            </div>
            <div class="content-box">
                <div class="form" id="account" style="display: block;">
                    <form id="modifyPassword" class="form-horizontal" action="#" method="post">
                        <input type="hidden" id="referer" name="referer" value="${param.referer}">
                        <div class="form-group">
                            <div class="col-xs-12">
                                <div class="input-group">
                                    <span class="input-group-addon"><span class="glyphicon glyphicon-user"></span></span>
                                    <input type="text" id="userNameId" name="userNameId" class="form-control"
                                           placeholder="账号">
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="col-xs-12">
                                <div class="input-group">
                                    <span class="input-group-addon"><span class="glyphicon glyphicon-lock"></span></span>
                                    <input type="password" id="password" name="password" class="form-control"
                                           placeholder="密码">
                                </div>
                            </div>
                        </div>
                        <div class="form-group form-actions">
                            <div class="col-xs-12 text-right">
                                <input type="checkbox" id="checkbox-fill-a1">
                                <label for="checkbox-fill-a1" class="cr" th:text="#{user.login.savePswd}"> 记住密码</label>
                            </div>
                            <div class="col-xs-12 text-center">
                                <button type="button" id="login" class="btn btn-sm btn-blue" style="width: 100%;border-radius:4px;margin-top: 10px" th:text="#{user.login.submit}">
                                    登录
                                </button>
                                <button type="button" id="reset" class="btn btn-sm" style="width: 100%;border-radius:4px;margin-top: 10px" th:text="#{user.login.reset}">
                                    重置
                                </button>
                                </br></br>
                                <a href="?lang=en_CN">中文</a>&nbsp;|&nbsp;<a href="?lang=en_US">English</a>
                            </div>
                        </div>
                    </form>
                </div>
            </div>

        </div>

    </div>
<!--     注释掉二维码-->
<!--    <div class="QR-code-box" style="">-->
<!--    </div>-->
</div>

<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog modal-sm" role="document">
        <div class="modal-content">
            <div class="modal-body">
                <span class="text-danger"><i class="fa fa-warning"></i> <span id="alertMsg">用户名或密码错误，请重试！</span></span>
            </div>
        </div>
    </div>
</div>

<!-- 引入jQuery -->
<script src="/plugins/jquery/jquery.min.js"></script>
<script src="/plugins/jquery/jquery.cookie.js"></script>
<script src="/plugins/bootstrap/js/bootstrap.min.js"></script>
<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
<script src="/plugins/bootstrap/plugins/html5shiv.min.js"></script>
<script src="/plugins/bootstrap/plugins/respond.min.js"></script>
<![endif]-->
<script type="text/javascript">
    if (navigator.appName == "Microsoft Internet Explorer" &&
        (navigator.appVersion.split(";")[1].replace(/[ ]/g, "") == "MSIE6.0" ||
            navigator.appVersion.split(";")[1].replace(/[ ]/g, "") == "MSIE7.0" ||
            navigator.appVersion.split(";")[1].replace(/[ ]/g, "") == "MSIE8.0")
    ) {
        alert("您的浏览器版本过低，请使用360安全浏览器的极速模式或IE9.0以上版本的浏览器");
    }
</script>
<!--document.getElementById("ck1").checked-->
<script type="text/javascript">
    $(function () {
        //从cookie中获取账户信息
        var cookie_username = getCookie('userNameId');
        var cookie_password = getCookie('password');
        if(cookie_username != ''){
            $("#userNameId").val(cookie_username);
            $("#password").val(cookie_password);
            $("#checkbox-fill-a1").prop("checked",true);
        }
        //删除cookie
        $.cookie('token', null, {'path': '/'});

        $('#password').keyup(function (event) {
            if (event.keyCode == "13") {
                $("#login").trigger("click");
                return false;
            }
        });

        $("#login").on("click", function () {
            submitForm();
        });

        function submitForm() {
            if(document.getElementById("checkbox-fill-a1").checked){
                setCookie("userNameId", $("#userNameId").val(), 7);
                setCookie("password", $("#password").val(), 7);
            }
            if (navigator.appName == "Microsoft Internet Explorer" &&
                (navigator.appVersion.split(";")[1].replace(/[ ]/g, "") == "MSIE6.0" ||
                    navigator.appVersion.split(";")[1].replace(/[ ]/g, "") == "MSIE7.0" ||
                    navigator.appVersion.split(";")[1].replace(/[ ]/g, "") == "MSIE8.0")
            ) {
                alert("您的浏览器版本过低，请使用360安全浏览器的极速模式或IE9.0以上版本的浏览器");
            } else {
                var formData = {
                    userNameId: $('#userNameId').val(),
                    password: $('#password').val()
                };
                $.ajax({
                    type: 'POST',
                    url: '/system/jwtLogin',
                    contentType: "application/json; charset=utf-8",
                    data: JSON.stringify(formData),
                    //data: formData,
                    success: function (data) {
                        if (data.statusCode == 200) {
                            location.href = '/system/index/index';
                            //location.href = data.referer;
                        } else {
                            //location.href = '/system/index/index';
                            $("#alertMsg").html(data.message);
                            $('#myModal').modal();
                            //alert("用户名或密码错误！");
                        }
                    },
                    error: function () {

                    }
                });
            }
        }

        $("#reset").on("click", function () {
            $("#userNameId").val("");
            $("#password").val("");
        });

        //取消记住密码,设cookie为空
        $("#checkbox-fill-a1").on("click", function () {
            if(getCookie('userNameId') != ''){
                setCookie("userNameId", "", -1);
                setCookie("password", "", -1);
                $("#userNameId").val("");
                $("#password").val("");
            }
        });

    });

    function setCookie(cname, cvalue, exdays){
        var d = new Date();
        d.setTime(d.getTime() + (exdays * 24 * 60 * 60 * 1000));
        var expires = "expires=" + d.toUTCString();
        document.cookie = cname + "=" + cvalue + "; " + expires;
    }

    function getCookie(cname){
        var name = cname + "=";
        var ca = document.cookie.split(';');
        for (var i = 0; i < ca.length; i++) {
            var c = ca[i];
            while (c.charAt(0) == ' ') c = c.substring(1);
            if (c.indexOf(name) != -1) return c.substring(name.length, c.length);
        }
        return "";
    }
</script>
</body>
</html>